# 每日新闻推送系统 - 开发文档

## 项目概述

自动从各优质数据源搜寻 AI、财经、科技新闻，通过 AI 筛选出最优质内容，每天 10 点自动推送到飞书。

## 参考项目

| 项目 | 特点 | 参考 |
|------|------|------|
| [RSS-AIGC](https://github.com/GongLingRui/rss-aigc) | RSS 订阅 + AI 内容聚合 + 飞书推送 | 核心架构参考 |
| [TrendRadar](https://github.com/sansan0/TrendRadar) | AI 驱动热点筛选 + 舆情分析 | 筛选算法参考 |
| [TechNews](https://github.com/qiu121/TechNews) | 每日科技/AI 资讯飞书推送 | 飞书模板参考 |
| [news-llama](https://github.com/slb350/news-llama) | AI 驱动新闻聚合 + 个性化推荐 | 整体设计参考 |

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        定时调度层 (Scheduler)                    │
│              GitHub Actions / Crontab (每天 10:00)                │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                          数据获取层 (Fetcher)                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │   API    │  │   RSS    │  │  Webhook │  │  Scraping│       │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       │
└───────┼────────────┼─────────────┼─────────────┼──────────────┘
        │            │             │             │
        ▼            ▼             ▼             ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据源层 (Sources)                         │
│  ┌──────────────────┐  ┌──────────────────┐  ┌───────────────┐ │
│  │  AI 新闻源       │  │  财经新闻源       │  │  科技新闻源    │ │
│  │  - Hacker News  │  │  - 财新网         │  │  - 36氪       │ │
│  │  - arXiv       │  │  - FT 中文        │  │  - 虎嗅       │ │
│  │  - TechCrunch  │  │  - Bloomberg      │  │  - TechCrunch │ │
│  └────────────────┘  └──────────────────┘  └───────────────┘ │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                         AI 处理层 (Processor)                     │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐     │
│  │  去重     │  │  筛选     │  │  排序     │  │  摘要     │     │
│  │  (SimHash)│  │  (LLM)    │  │  (Score)  │  │  (LLM)    │     │
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘     │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                        存储层 (Storage)                           │
│                   SQLite / JSON 文件 (历史记录)                  │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                         推送层 (Sender)                           │
│                    飞书 Webhook (消息卡片模板)                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 技术栈

| 层级 | 技术选择 | 说明 |
|------|----------|------|
| 编程语言 | Python 3.9+ | 生态丰富，AI 库支持好 |
| HTTP 请求 | `httpx` | 异步支持，性能好 |
| RSS 解析 | `feedparser` | 成熟的 RSS 解析库 |
| AI 摘要/筛选 | OpenAI API / DeepSeek | GPT-4o-mini 或 DeepSeek（性价比高） |
| 去重算法 | `simhash` | 快速文本去重 |
| 数据存储 | `SQLite` | 轻量级，无需额外部署 |
| 定时任务 | `crontab` | macOS/Linux 原生支持 |
| 飞书推送 | 现有 `feishu_bot.py` | 已测试可用 |

---

## 数据源配置

### AI 新闻源
```python
AI_SOURCES = {
    "hacker_news": {
        "type": "api",
        "url": "https://hacker-news.firebaseio.com/v0/topstories.json",
        "detail_url": "https://hacker-news.firebaseio.com/v0/item/{}.json"
    },
    "arxiv_ai": {
        "type": "rss",
        "url": "http://export.arxiv.org/rss/cs.AI"
    },
    "techcrunch_ai": {
        "type": "rss",
        "url": "https://techcrunch.com/category/artificial-intelligence/feed/"
    }
}
```

### 财经新闻源
```python
FINANCE_SOURCES = {
    "caixin": {
        "type": "rss",
        "url": "https://www.caixin.com/rss/finance.xml"
    },
    "ft_chinese": {
        "type": "rss",
        "url": "https://www.ftchinese.com/rss/feed"
    },
    "wallstreet_cn": {
        "type": "rss",
        "url": "https://api.wallstreetcn.com/rss"
    }
}
```

### 科技新闻源
```python
TECH_SOURCES = {
    "36kr": {
        "type": "rss",
        "url": "https://36kr.com/feed"
    },
    "huxiu": {
        "type": "rss",
        "url": "https://www.huxiu.com/rss/0.xml"
    },
    "the_verge": {
        "type": "rss",
        "url": "https://www.theverge.com/rss/index.xml"
    }
}
```

---

## AI 筛选与摘要

### 筛选标准（通过 LLM 评分）

```python
SCORING_PROMPT = """
你是一个新闻质量评估专家。请根据以下标准对新闻进行 1-10 分评分：

1. 信息价值（3 分）：是否有独特信息、深度分析
2. 时效性（2 分）：是否是最新热点
3. 影响力（3 分）：对行业/社会的潜在影响
4. 可读性（2 分）：内容是否清晰易懂

新闻标题：{title}
新闻内容摘要：{content}

请只返回 JSON：{{"score": 分数, "reason": "评分理由"}}
"""
```

### 摘要生成

```python
SUMMARY_PROMPT = """
请用 1-2 句话提炼这篇新闻的核心价值，突出关键信息。

标题：{title}
内容：{content}

要求：
- 简洁有力，不超过 100 字
- 突出最关键的信息点
- 如果是技术新闻，提及技术名称/公司
"""
```

---

## 飞书推送模板

### 消息卡片设计

```
┌────────────────────────────────────────────────────┐
│  📰 每日科技资讯日报  |  2026-02-14  星期五       │
├────────────────────────────────────────────────────┤
│                                                     │
│  🤖 AI 资讯 (Top 10)                                │
│  ────────────────────────────────────────────       │
│  1. OpenAI 发布 GPT-5 预览版                        │
│     模型推理能力提升 300%，支持实时语音交互           │
│     https://openai.com/blog/gpt5                    │
│                                                     │
│  2. Anthropic 推出 Claude 4.0                       │
│     ...                                             │
│                                                     │
├────────────────────────────────────────────────────┤
│  💰 财经资讯 (Top 10)                               │
│  ────────────────────────────────────────────       │
│  ...                                                │
│                                                     │
├────────────────────────────────────────────────────┤
│  💻 科技资讯 (Top 10)                               │
│  ────────────────────────────────────────────       │
│  ...                                                │
│                                                     │
├────────────────────────────────────────────────────┤
│  ⏰ 生成时间：2026-02-14 10:00                      │
│  📊 今日处理：234 篇 → 精选 30 篇                   │
└────────────────────────────────────────────────────┘
```

---

## 文件结构

```
daily_news_bot/
├── config/
│   ├── sources.yaml          # 数据源配置
│   └── prompts.yaml          # AI 提示词配置
├── src/
│   ├── fetcher/              # 数据获取模块
│   │   ├── __init__.py
│   │   ├── base.py           # 基类
│   │   ├── rss_fetcher.py    # RSS 获取
│   │   └── api_fetcher.py    # API 获取
│   ├── processor/            # AI 处理模块
│   │   ├── __init__.py
│   │   ├── deduplication.py  # 去重
│   │   ├── filter.py         # 筛选
│   │   └── summarizer.py     # 摘要
│   ├── storage/              # 存储模块
│   │   ├── __init__.py
│   │   └── database.py       # SQLite 操作
│   ├── sender/               # 推送模块
│   │   ├── __init__.py
│   │   └── feishu.py         # 飞书推送
│   ├── models/               # 数据模型
│   │   ├── __init__.py
│   │   └── article.py        # 文章模型
│   └── main.py               # 主入口
├── data/
│   └── news.db               # SQLite 数据库
├── logs/                     # 日志目录
├── requirements.txt          # 依赖
├── run.py                    # 运行脚本
└── README.md                 # 说明文档
```

---

## 环境变量配置

```bash
# .env 文件
FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/b1d55080-ee95-44fe-b73d-f2484736bcff

# AI API（二选一）
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1

# 或使用 DeepSeek（性价比高）
DEEPSEEK_API_KEY=sk-xxx
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

# 使用哪个 LLM
LLM_PROVIDER=deepseek  # openai 或 deepseek

# 每个分类返回几条
NEWS_PER_CATEGORY=10
```

---

## 定时任务配置

### 方式一：crontab（推荐本地运行）

```bash
# 每天上午 10:00 运行
0 10 * * * cd /Users/mac/Desktop/claudecode项目/每日新闻推送系统 && /usr/local/bin/python3 run.py >> logs/cron.log 2>&1
```

### 方式二：GitHub Actions（推荐服务器运行）

```yaml
name: Daily News Bot
on:
  schedule:
    - cron: '0 2 * * *'  # UTC 2:00 = 北京 10:00
  workflow_dispatch:      # 支持手动触发

jobs:
  fetch-and-send:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      - run: pip install -r requirements.txt
      - env:
          FEISHU_WEBHOOK: ${{ secrets.FEISHU_WEBHOOK }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: python run.py
```

---

## 开发阶段规划

### Phase 1：基础框架（1-2 天）
- [x] 项目结构设计
- [ ] 数据模型定义
- [ ] 配置文件创建
- [ ] 基础类和接口定义

### Phase 2：数据获取（2-3 天）
- [ ] RSS Fetcher 实现
- [ ] API Fetcher 实现
- [ ] 数据源接入测试
- [ ] 异常处理和重试机制

### Phase 3：AI 处理（2-3 天）
- [ ] SimHash 去重实现
- [ ] LLM 筛选评分实现
- [ ] 摘要生成实现
- [ ] 性能优化（批量处理）

### Phase 4：飞书推送（1 天）
- [ ] 消息卡片模板设计
- [ ] 飞书发送模块
- [ ] 推送格式美化

### Phase 5：定时任务（1 天）
- [ ] crontab 配置
- [ ] 日志系统
- [ ] 错误告警

### Phase 6：测试与优化（1-2 天）
- [ ] 端到端测试
- [ ] 性能优化
- [ ] 数据源质量调优

---

## 预计工作量

| 阶段 | 时间 | 说明 |
|------|------|------|
| 基础框架 | 1-2 天 | 项目搭建、模型定义 |
| 数据获取 | 2-3 天 | RSS/API 接入 |
| AI 处理 | 2-3 天 | 去重、筛选、摘要 |
| 飞书推送 | 1 天 | 模板设计和发送 |
| 定时任务 | 1 天 | crontab 配置 |
| 测试优化 | 1-2 天 | 端到端测试 |
| **总计** | **8-12 天** | 约 2 周 |

---

## 成本估算

| 项目 | 成本 | 说明 |
|------|------|------|
| LLM API | ¥50-100/月 | DeepSeek 约 ¥1/百万 tokens |
| 服务器 | ¥0 | 本地运行 / GitHub Actions 免费 |
| **总计** | **¥50-100/月** | 主要是 AI 成本 |

---

## 风险与对策

| 风险 | 对策 |
|------|------|
| RSS 源不稳定 | 多源备份，异常处理 |
| LLM API 限流 | 请求队列，重试机制 |
| 内容质量波动 | 动态调整筛选阈值 |
| 飞书推送失败 | 本地备份，错误告警 |

---

## 后续优化方向

1. **用户反馈学习**：根据点击率调整筛选标准
2. **多渠道推送**：支持邮件、Telegram 等
3. **个性化推荐**：基于用户兴趣定制内容
4. **历史数据分析**：热门趋势追踪
5. **图片支持**：抓取新闻配图

---

## 参考资料

- [飞书开放平台 - 消息卡片](https://open.feishu.cn/document/interaction-guide)
- [feedparser 文档](https://pythonhosted.org/feedparser/)
- [SimHash 去重算法](https://github.com/seomoz/simhash-py)
